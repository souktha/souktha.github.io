<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://souktha.github.io/hardware/cyclic_1_x_x4_hw/">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simple Cyclic Hamming (15,11,3) FEC | Soukthavy Sopha</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://souktha.github.io/hardware/cyclic_1_x_x4_hw/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Soukthavy">
<link rel="prev" href="../../misc/cyclic_1_x_x4/" title="Simple Cyclic Hamming codes" type="text/html">
<link rel="next" href="../../misc/create-ap-linuxpc/" title="Create Wireless AP on Linux PC in 10 minutes" type="text/html">
<meta property="og:site_name" content="Soukthavy Sopha">
<meta property="og:title" content="Simple Cyclic Hamming (15,11,3) FEC">
<meta property="og:url" content="http://souktha.github.io/hardware/cyclic_1_x_x4_hw/">
<meta property="og:description" content="This post is the implementation part of the my post on simple cyclic Hamming code
where I did some math workout on this type of forward error-correction code (FEC). I am doing
it for fun since I think">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-12-22T00:17:42Z">
<meta property="article:tag" content="hardware">
<meta property="article:tag" content="latex">
<meta property="article:tag" content="mathjax">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://souktha.github.io/">

                <span id="blog-title">Soukthavy Sopha</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blog <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../software">Sofware</a>
                    </li>
<li>
<a href="../../hardware">Hardware</a>
                    </li>
<li>
<a href="../../misc">Misc</a>
            </li>
</ul>
</li>
<li>
<a href="https://github.com/souktha">My Github</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Simple Cyclic Hamming (15,11,3) FEC</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>This post is the implementation part of the my post on <a class="reference external" href="http://souktha.github.io/misc/cyclic_1_x_x4">simple cyclic Hamming code</a>
where I did some math workout on this type of forward error-correction code (FEC). I am doing
it for fun since I think it is simple enough to implement it in FPGA. The generator
for this exercise is <span class="math">\(g(x)=1+x+x4\)</span> for an <span class="math">\((n,k,d) \equiv (15,11,3)\)</span> code.</p>
<!-- TEASER_END -->
<div class="section" id="implementation">
<h2>Implementation</h2>
<p>If the data to be encoded is parallel data block, the encoded message can simply be done with
simple combinational logic based on the <span class="math">\(G\)</span> matrix, likewise for the decoder logic, but
this is too boring. I choose to complicate this matter by assuming that the input data bits
to be encoded or decoded arrive serially, perhaps from a transceiver part of the circuit. This
way I can implement it with divider circuit and get myself frustrated with timing closure and
everything else. Simple and elegant way is not always paid off. This is what I am going to do.</p>
<p>For this exercise, I am targeting the Xilinx Artix FPGA device. I create three verilog modules,</p>
<p>. Encoder for encoding 11-bit message to 15-bit message.</p>
<p>. Decoder for decoding the 15-bit receiving message.</p>
<p>. Corrector is for correcting the error if syndrome indicates the error.</p>
<div class="section" id="the-encoder">
<h3>The encoder</h3>
<p>The encoder takes a stream of 11-bit input message and encodes it to 15-bit messages in
systematic form. The input bit is clocked in bit-by-bit to the encoder whenever <em>enc_enable</em>
is asserted. On the completion of the encoding process, the <em>rdy</em> is asserted as an output
ready indicator so that the 15-bit encoded message can be read.</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-1"> 1</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-2"> 2</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-3"> 3</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-4"> 4</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-5"> 5</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-6"> 6</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-7"> 7</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-8"> 8</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-9"> 9</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-10">10</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-11">11</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-12">12</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-13">13</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-14">14</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-15">15</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-16">16</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-17">17</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-18">18</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-19">19</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-20">20</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-21">21</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-22">22</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-23">23</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-24">24</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-25">25</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-26">26</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-27">27</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-28">28</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-29">29</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-30">30</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-31">31</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-32">32</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-33">33</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-34">34</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-35">35</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-36">36</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-37">37</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-38">38</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-39">39</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-40">40</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-41">41</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-42">42</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-43">43</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-44">44</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-45">45</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-46">46</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-47">47</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-48">48</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-49">49</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-50">50</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-51">51</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-52">52</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-53">53</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-54">54</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-55">55</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-56">56</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-57">57</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-58">58</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-59">59</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-60">60</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-61">61</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-62">62</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-63">63</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-64">64</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-65">65</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-66">66</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-67">67</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-68">68</a>
<a href="#rest_code_372d1dc1712e4c8a830ab628470cc2d5-69">69</a></pre></div></td>
<td class="code"><pre class="code verilog"><a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-1"></a>     <span class="cm">/*(n,k,d) = (15,11,3)</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-2"></a><span class="cm">     input is serialized 11 bits, output is 15 bits*/</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-3"></a>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-4"></a>     <span class="k">module</span> <span class="n">cyclic_1_x_x4_encode</span> <span class="p">#(</span><span class="k">parameter</span> <span class="no">IWIDTH</span><span class="o">=</span><span class="mh">11</span><span class="p">,</span> <span class="no">OWIDTH</span><span class="o">=</span><span class="mh">15</span><span class="p">)</span> <span class="p">(</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-5"></a>         <span class="k">input</span> <span class="n">clk</span><span class="p">,</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-6"></a>         <span class="k">input</span> <span class="n">enc_enable</span><span class="p">,</span> <span class="c1">//enable encoder</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-7"></a>         <span class="k">output</span> <span class="n">bsy</span><span class="p">,</span> <span class="c1">// state of encoder</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-8"></a>         <span class="k">output</span> <span class="n">rdy</span><span class="p">,</span> <span class="c1">// 1 when decoded data is ready for reading.</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-9"></a>         <span class="k">input</span>  <span class="n">ibit</span><span class="p">,</span> <span class="c1">//serialize input bit input code word</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-10"></a>         <span class="k">output</span> <span class="p">[</span><span class="no">OWIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">codeword</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-11"></a>         <span class="p">);</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-12"></a>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-13"></a>         <span class="p">..</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-14"></a>         <span class="p">..</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-15"></a>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-16"></a>         <span class="k">assign</span> <span class="n">fbypass</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="no">`KBITS</span><span class="p">);</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-17"></a>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-18"></a>         <span class="k">always</span><span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-19"></a>             <span class="k">if</span> <span class="p">(</span> <span class="n">enc_enable</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-20"></a>                 <span class="k">if</span> <span class="p">(</span> <span class="n">count</span> <span class="o">==</span> <span class="mh">5'h0</span>  <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-21"></a>                     <span class="n">busy</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-22"></a>                     <span class="n">ready</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-23"></a>                 <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-24"></a>                 <span class="k">else</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-25"></a>                     <span class="k">if</span> <span class="p">(</span> <span class="n">fbypass</span>  <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-26"></a>                        <span class="cm">/*pass through k bits of message*/</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-27"></a>                         <span class="n">busy</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-28"></a>                         <span class="n">ready</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-29"></a>                         <span class="n">cw</span> <span class="o">&lt;=</span> <span class="p">{</span><span class="n">cw</span><span class="p">[</span><span class="no">OWIDTH</span><span class="o">-</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">],</span><span class="n">ibit</span><span class="p">};</span> <span class="c1">//left shift to MSB begin with 1st bit</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-30"></a>                         <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-31"></a>                     <span class="k">else</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-32"></a>                         <span class="n">cw</span> <span class="o">&lt;=</span> <span class="p">{</span><span class="n">cw</span><span class="p">[</span><span class="no">OWIDTH</span><span class="o">-</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">],</span><span class="n">q</span><span class="p">[</span><span class="mh">3</span><span class="p">]};</span> <span class="c1">//concat parity bits to form coded word</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-33"></a>                         <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="no">`NBITS</span><span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-34"></a>                          <span class="n">busy</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-35"></a>                          <span class="n">ready</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-36"></a>                         <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-37"></a>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-38"></a>                         <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-39"></a>                 <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-40"></a>             <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-41"></a>             <span class="k">else</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-42"></a>                 <span class="n">cw</span> <span class="o">&lt;=</span> <span class="mh">15'h0</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-43"></a>                 <span class="n">busy</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-44"></a>                 <span class="n">ready</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-45"></a>                 <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-46"></a>         <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-47"></a>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-48"></a>         <span class="cm">/*encoder for generator g(x) = 1 + x + x**4*/</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-49"></a>         <span class="k">always</span><span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-50"></a>             <span class="k">if</span> <span class="p">(</span><span class="n">enc_enable</span><span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-51"></a>                 <span class="n">q</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">&lt;=</span>  <span class="n">q</span><span class="p">[</span><span class="mh">2</span><span class="p">];</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-52"></a>                 <span class="n">q</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">&lt;=</span>  <span class="n">q</span><span class="p">[</span><span class="mh">1</span><span class="p">];</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-53"></a>                 <span class="k">if</span> <span class="p">(</span> <span class="n">fbypass</span> <span class="p">)</span>  <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-54"></a>                     <span class="n">q</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&lt;=</span>  <span class="n">q</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">^</span> <span class="n">q</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">ibit</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-55"></a>                     <span class="n">q</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">&lt;=</span>  <span class="n">ibit</span> <span class="o">^</span> <span class="n">q</span><span class="p">[</span><span class="mh">3</span><span class="p">];</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-56"></a>                 <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-57"></a>                 <span class="k">else</span> <span class="k">begin</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-58"></a>                     <span class="n">q</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-59"></a>                     <span class="n">q</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-60"></a>                     <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-61"></a>                 <span class="k">if</span> <span class="p">(</span> <span class="n">count</span> <span class="o">==</span> <span class="mh">5'h0</span> <span class="p">)</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-62"></a>                     <span class="n">q</span> <span class="o">&lt;=</span> <span class="mh">4</span><span class="mb">'b0000</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-63"></a>             <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-64"></a>             <span class="k">else</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-65"></a>                 <span class="n">q</span> <span class="o">&lt;=</span> <span class="mh">4</span><span class="mb">'b0000</span><span class="p">;</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-66"></a>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-67"></a>         <span class="k">end</span>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-68"></a>
<a name="rest_code_372d1dc1712e4c8a830ab628470cc2d5-69"></a>     <span class="k">endmodule</span>
</pre></td>
</tr></table>
<p>Th encoder part of this module is between line 16-46. The divider circuit that forms the <span class="math">\(P_i\)</span> bits is between line 49-67.
The lines that forms the output coded word are at line 29 and 32. The sample simulation below shows one of the encoded message.
Any <span class="math">\(2^{11}\)</span> input message words can be encoded by this circuit and matches with the multiplication of the
<span class="math">\(G\)</span> matrix. This is how I know that the divider circuit works.</p>
<div class="figure">
<img alt="../../images/hardware/encode_h1.jpg" src="../../images/hardware/encode_h1.jpg"><p class="caption">Fig1: encoded message 01h</p>
</div>
</div>
<div class="section" id="the-decoder-and-fec">
<h3>The decoder and FEC</h3>
<p>The FEC decoder is the reverse of the encoder where it takes in the serial 15-bit code word, computes
the syndrome and if any 1-bit error is detected, the instantiated lookup bit correction will return
the correctable bit position. This completed the FEC process.</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-1"> 1</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-2"> 2</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-3"> 3</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-4"> 4</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-5"> 5</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-6"> 6</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-7"> 7</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-8"> 8</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-9"> 9</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-10">10</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-11">11</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-12">12</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-13">13</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-14">14</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-15">15</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-16">16</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-17">17</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-18">18</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-19">19</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-20">20</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-21">21</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-22">22</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-23">23</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-24">24</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-25">25</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-26">26</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-27">27</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-28">28</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-29">29</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-30">30</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-31">31</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-32">32</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-33">33</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-34">34</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-35">35</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-36">36</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-37">37</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-38">38</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-39">39</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-40">40</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-41">41</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-42">42</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-43">43</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-44">44</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-45">45</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-46">46</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-47">47</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-48">48</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-49">49</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-50">50</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-51">51</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-52">52</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-53">53</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-54">54</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-55">55</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-56">56</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-57">57</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-58">58</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-59">59</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-60">60</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-61">61</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-62">62</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-63">63</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-64">64</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-65">65</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-66">66</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-67">67</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-68">68</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-69">69</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-70">70</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-71">71</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-72">72</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-73">73</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-74">74</a>
<a href="#rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-75">75</a></pre></div></td>
<td class="code"><pre class="code verilog"><a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-1"></a>     <span class="k">module</span> <span class="n">cyclic_1_x_x4_decode</span> <span class="p">#(</span><span class="k">parameter</span> <span class="no">IWIDTH</span><span class="o">=</span><span class="mh">15</span><span class="p">,</span> <span class="no">OWIDTH</span><span class="o">=</span><span class="mh">11</span><span class="p">)</span> <span class="p">(</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-2"></a>         <span class="k">input</span> <span class="n">clk</span><span class="p">,</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-3"></a>         <span class="k">input</span> <span class="n">dec_enable</span><span class="p">,</span> <span class="c1">//enable decoder</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-4"></a>         <span class="k">input</span>  <span class="n">ibit</span><span class="p">,</span> <span class="c1">//serialize input bit input code word</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-5"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-6"></a>         <span class="k">output</span> <span class="n">bsy</span><span class="p">,</span> <span class="c1">// state of decoder</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-7"></a>         <span class="k">output</span> <span class="n">rdy</span><span class="p">,</span> <span class="c1">// 1 when decoded data is ready for reading.</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-8"></a>             <span class="k">output</span> <span class="n">err</span><span class="p">,</span> <span class="c1">// error if undecodable</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-9"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-10"></a>         <span class="k">output</span> <span class="p">[</span><span class="no">OWIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">outw</span> <span class="c1">//11 bit output decoded word</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-11"></a>     <span class="p">);</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-12"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-13"></a>     <span class="p">..</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-14"></a>     <span class="p">..</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-15"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-16"></a>     <span class="k">assign</span> <span class="n">outw</span> <span class="o">=</span> <span class="n">cw</span><span class="p">[</span><span class="no">IWIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="no">`PBITS</span><span class="p">]</span> <span class="o">^</span> <span class="n">bit_correction</span><span class="p">[</span><span class="no">IWIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="no">`PBITS</span><span class="p">];</span> <span class="c1">//bit 4 to 14 for this case</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-17"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-18"></a>     <span class="k">always</span><span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-19"></a>             <span class="k">if</span> <span class="p">(</span><span class="n">dec_enable</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-20"></a>                     <span class="k">if</span> <span class="p">(</span> <span class="n">count</span> <span class="o">==</span> <span class="mh">5'h0</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-21"></a>                             <span class="n">busy</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-22"></a>                             <span class="n">ready</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-23"></a>                     <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-24"></a>                     <span class="k">else</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-25"></a>                             <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="no">`NBITS</span><span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-26"></a>                                     <span class="cm">/*This is to output data long enough to be read.*/</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-27"></a>                                     <span class="n">busy</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-28"></a>                                     <span class="n">ready</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-29"></a>                                     <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-30"></a>                             <span class="k">else</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-31"></a>                                     <span class="n">busy</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-32"></a>                                     <span class="n">ready</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-33"></a>                                     <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-34"></a>                             <span class="n">quotient</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="p">{</span><span class="n">quotient</span><span class="p">[</span><span class="no">IWIDTH</span><span class="o">-</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">],</span><span class="n">r</span><span class="p">[</span><span class="mh">3</span><span class="p">]};</span> <span class="c1">//shift in MSB</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-35"></a>                     <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-36"></a>             <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-37"></a>             <span class="k">else</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-38"></a>                 <span class="n">busy</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-39"></a>                 <span class="n">ready</span> <span class="o">&lt;=</span> <span class="p">#</span><span class="mh">1</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-40"></a>             <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-41"></a>         <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-42"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-43"></a> <span class="cm">/*dvivider for g(x) = 1 + x + x**4*/</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-44"></a> <span class="k">always</span><span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-45"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">dec_enable</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-46"></a>             <span class="k">if</span> <span class="p">(</span> <span class="n">count</span> <span class="o">==</span> <span class="mh">5'h0</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-47"></a>                 <span class="n">r</span> <span class="o">&lt;=</span> <span class="mh">4</span><span class="mb">'b0000</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-48"></a>                 <span class="n">ierr</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-49"></a>             <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-50"></a>             <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="no">`NBITS</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-51"></a>                     <span class="n">r</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">[</span><span class="mh">2</span><span class="p">];</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-52"></a>                     <span class="n">r</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">[</span><span class="mh">1</span><span class="p">];</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-53"></a>                     <span class="n">r</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">^</span> <span class="n">r</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-54"></a>                     <span class="n">r</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ibit</span> <span class="o">^</span> <span class="n">r</span><span class="p">[</span><span class="mh">3</span><span class="p">];</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-55"></a>                     <span class="n">cw</span> <span class="o">&lt;=</span> <span class="p">{</span><span class="n">cw</span><span class="p">[</span><span class="no">IWIDTH</span><span class="o">-</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">],</span><span class="n">ibit</span><span class="p">};</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-56"></a>                     <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">!=</span> <span class="mh">4'h0</span> <span class="p">)</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-57"></a>                             <span class="n">ierr</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-58"></a>                     <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-59"></a>             <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-60"></a>             <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-61"></a>             <span class="k">else</span> <span class="k">begin</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-62"></a>                 <span class="n">r</span> <span class="o">&lt;=</span> <span class="mh">4'h0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-63"></a>                 <span class="n">ierr</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-64"></a>             <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-65"></a> <span class="k">end</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-66"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-67"></a> <span class="k">assign</span> <span class="n">lookup_en</span> <span class="o">=</span> <span class="n">ierr</span><span class="p">;</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-68"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-69"></a> <span class="n">lookup11</span> <span class="n">correct</span><span class="p">(</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-70"></a>     <span class="p">.</span><span class="n">en</span><span class="p">(</span><span class="n">lookup_en</span><span class="p">),</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-71"></a>     <span class="p">.</span><span class="n">syndrome</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="c1">//the remainder of division</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-72"></a>     <span class="p">.</span><span class="n">errbits</span><span class="p">(</span><span class="n">bit_correction</span><span class="p">)</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-73"></a>     <span class="p">);</span>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-74"></a>
<a name="rest_code_859ca6e4e2704c2faeb19d9b7289c5f9-75"></a> <span class="k">endmodule</span>
</pre></td>
</tr></table>
<p>The divider circuit (line 44-65) for the decoder is similar to that of the encoder, but it performs syndrome computation
by taking all the input bits having the remainder shifted into the decoded output word. If the remainder is non-zero,
it set <em>ierr</em> bit as an enabler for <em>lookup11</em> module (line 67-73). The table lookup module returns the corresponding bit
error, <em>bit_correction</em>, where it does the modulo-2 sum to the decoded word (line 16). This is the FEC.</p>
<p>The lookup module is a simple ROM type lookup table using the 4-bit syndrome as the index to the correction bit. It
returns non-zeros for <em>errbits</em> on any error, zeros otherwise. It covers both message bits and parity bits.</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-1"> 1</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-2"> 2</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-3"> 3</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-4"> 4</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-5"> 5</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-6"> 6</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-7"> 7</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-8"> 8</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-9"> 9</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-10">10</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-11">11</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-12">12</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-13">13</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-14">14</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-15">15</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-16">16</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-17">17</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-18">18</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-19">19</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-20">20</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-21">21</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-22">22</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-23">23</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-24">24</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-25">25</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-26">26</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-27">27</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-28">28</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-29">29</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-30">30</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-31">31</a>
<a href="#rest_code_a17d6ecc58f24520b20bef18e3544c43-32">32</a></pre></div></td>
<td class="code"><pre class="code text"><a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-1"></a>     module lookup11 #(parameter WIDTH=15) (
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-2"></a>         input en,
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-3"></a>         input [3:0] syndrome,
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-4"></a>         output [WIDTH-1:0] errbits
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-5"></a>         );
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-6"></a>         reg [WIDTH-1:0] bitpos;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-7"></a>
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-8"></a>         assign errbits = bitpos;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-9"></a>
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-10"></a>         always@(*) begin
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-11"></a>             if (!en) bitpos = 15'h0;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-12"></a>         else
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-13"></a>         case (syndrome)
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-14"></a>             4'h0: bitpos = 15'h0;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-15"></a>             4'h1: bitpos = 15'h1;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-16"></a>             4'h2: bitpos = 15'h2;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-17"></a>             4'h4: bitpos = 15'h4;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-18"></a>             4'h8: bitpos = 15'h8;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-19"></a>             4'h3: bitpos = 15'h10;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-20"></a>             4'h6: bitpos = 15'h20;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-21"></a>             4'hc: bitpos = 15'h40;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-22"></a>             4'hb: bitpos = 15'h80;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-23"></a>             4'h5: bitpos = 15'h100;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-24"></a>             4'ha: bitpos = 15'h200;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-25"></a>             4'h7: bitpos = 15'h400;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-26"></a>             4'he: bitpos = 15'h800;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-27"></a>             4'hf: bitpos = 15'h1000;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-28"></a>             4'hd: bitpos = 15'h2000;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-29"></a>             4'h9: bitpos = 15'h4000;
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-30"></a>         endcase
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-31"></a>         end
<a name="rest_code_a17d6ecc58f24520b20bef18e3544c43-32"></a>     endmodule
</pre></td>
</tr></table>
<div class="figure">
<img alt="../../images/hardware/decode_73d.jpg" src="../../images/hardware/decode_73d.jpg"><p class="caption">Fig1: decoded non-error message 0x73d for 0x73</p>
</div>
<p>I test the FEC logic with random test vector for several coded words out of <span class="math">\(2^{11}\)</span> possible coded words
and I can verify that any single bit error is corrected as it is a <span class="math">\(t=1\)</span> FEC. The code rate for this
implentation is <span class="math">\(\frac{k}{n} = \frac{11}{15}\)</span></p>
<p>What is really needed for this FEC is only to correct the message error bit, any bit of the 11-bit. The <em>err</em> bit
can be used as a request for retransmission if the error bit falls into the parity area. This means that
certain syndrome in the look up table will be partially used.</p>
<p>Shortened code <span class="math">\((n-l,k-l,d)=(12,8,3)\)</span> can also be obtained using this exact scheme with minimal change to
the logic because it is more practical to do it in 8-bit rather than 11-bit. It is no longer cyclic, but it
offers the same error-correcting capability as its normal version.</p>
<div class="figure">
<img alt="../../images/hardware/decoded_33d.jpg" src="../../images/hardware/decoded_33d.jpg"><p class="caption">Fig1: FEC 1-bit error (bit 6) in coded word. Decoded and Corrected 0x33d for 0x73</p>
</div>
<p>I believe that my implementation is what is called Meggitt decoder. Since I do not take into account the error
confinement, it has certain restriction such as <em>error trapping</em> so future improvement is needed.</p>
</div>
<div class="section" id="conclusion">
<h3>Conclusion</h3>
<p>Cyclic code FEC of this type can be easily implemented with shift registers to perform modulo
division. The FEC in this exercise may not be efficient, but if it requires that the FEC be
implemented with minimal gates then it would be practical.</p>
<p>When time permits, I will try to implement <span class="math">\(t &gt; 1\)</span> FEC.</p>
</div>
</div>
</div>
    </div>
    
            <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
            MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
            </script></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:soukthavy@yahoo.com">Soukthavy</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
